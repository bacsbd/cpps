/* Middle ware to maintain User Hierarchy
 *
 * 0. root
 * 1. admin
 */

module.exports = {
  isRoot(req, res, next) {
    const sess = req.session || {};
    if (sess.status === 'root') return next();

    const regexApi = /^\/api\/v1/g;
    if (regexApi.exec(req.originalUrl)) {
      return res.status(401).json({
        status: 401,
        message: 'Unauthorized: You are not Root',
        route: req.originalUrl,
      });
    }

    req.flash('info', 'You must be root to proceed');
    return res.status(401).redirect('/');
  },

  isAdmin(req, res, next) {
    const sess = req.session || {};
    if (sess.status === 'root' || sess.status === 'admin') return next();

    const regexApi = /^\/api\/v1/g;
    if (regexApi.exec(req.originalUrl)) {
      return res.status(401).json({
        status: 401,
        message: 'Unauthorized: You are not Admin',
        route: req.originalUrl,
      });
    }

    req.flash('info', 'You must be at least "admin" to proceed');
    return res.status(401).redirect('/');
  },
};
